From 24256fc73b11af3d83adff4870ff41989517ffb9 Mon Sep 17 00:00:00 2001
From: John Johansen <john@jjmx.net>
Date: Tue, 23 May 2023 21:40:06 +0000
Subject: [PATCH] Merge extend test profiles for mount

- in bad_?.sd, explain why the profile is bad (conflicting options)
- add a good profile with two space-separated options

This is a follow-up for https://gitlab.com/apparmor/apparmor/-/merge_requests/1029

If we backport !1029, we should also backport these test changes.

MR: https://gitlab.com/apparmor/apparmor/-/merge_requests/1035
Approved-by: John Johansen <john@jjmx.net>
Merged-by: John Johansen <john@jjmx.net>
(cherry picked from commit d700f87d3e700796143d9d2fe5ba07c84b487a06)
Signed-off-by: John Johansen <john.johansen@canonical.com>
---
 parser/tst/simple_tests/mount/bad_1.sd | 2 +-
 parser/tst/simple_tests/mount/bad_2.sd | 2 +-
 parser/tst/simple_tests/mount/bad_3.sd | 2 +-
 parser/tst/simple_tests/mount/bad_4.sd | 2 +-
 parser/tst/simple_tests/mount/ok_16.sd | 7 +++++++
 5 files changed, 11 insertions(+), 4 deletions(-)
 create mode 100644 parser/tst/simple_tests/mount/ok_16.sd

--- apparmor-3.0.4.orig/parser/tst/simple_tests/mount/bad_1.sd
+++ apparmor-3.0.4/parser/tst/simple_tests/mount/bad_1.sd
@@ -1,5 +1,5 @@
 #
-#=Description basic mount rule
+#=Description basic mount rule with incompatible options
 #=EXRESULT FAIL
 #
 /usr/bin/foo {
--- apparmor-3.0.4.orig/parser/tst/simple_tests/mount/bad_2.sd
+++ apparmor-3.0.4/parser/tst/simple_tests/mount/bad_2.sd
@@ -1,5 +1,5 @@
 #
-#=Description basic mount rule
+#=Description basic mount rule with incompatible options
 #=EXRESULT FAIL
 #
 /usr/bin/foo {
--- apparmor-3.0.4.orig/parser/tst/simple_tests/mount/bad_3.sd
+++ apparmor-3.0.4/parser/tst/simple_tests/mount/bad_3.sd
@@ -1,5 +1,5 @@
 #
-#=Description basic mount rule
+#=Description basic mount rule with incompatible options
 #=EXRESULT FAIL
 #
 /usr/bin/foo {
--- apparmor-3.0.4.orig/parser/tst/simple_tests/mount/bad_4.sd
+++ apparmor-3.0.4/parser/tst/simple_tests/mount/bad_4.sd
@@ -1,5 +1,5 @@
 #
-#=Description basic mount rule
+#=Description basic mount rule with incompatible options
 #=EXRESULT FAIL
 #
 /usr/bin/foo {
--- /dev/null
+++ apparmor-3.0.4/parser/tst/simple_tests/mount/ok_16.sd
@@ -0,0 +1,7 @@
+#
+#=Description basic mount rule
+#=EXRESULT PASS
+#
+/usr/bin/foo {
+  mount options=(rw nosuid) -> /foo,
+}
